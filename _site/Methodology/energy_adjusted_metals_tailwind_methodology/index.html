<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Energy‑Adjusted Metals Tailwind — Methodology</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300;400;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body{font-family:"Merriweather",serif}
    h1,h2,h3,h4{font-family:"Inter",sans-serif}
    .container{max-width:960px}
    .rule{height:1px;background:linear-gradient(90deg,#e5e7eb,transparent)}
    .smallcaps{font-variant-caps:all-small-caps;letter-spacing:.04em}
    @media print{nav,.screen-only{display:none!important} body{color:#000}}
    .eq{font-family:"Merriweather",serif;font-style:italic}
    .box{border:1px solid #e5e7eb;border-radius:.75rem;padding:1rem;background:#fafafa}
    code{background:#f6f8fa;padding:.15rem .35rem;border-radius:.35rem}
    .callout{border-left:4px solid #0ea5e9;background:#f0f9ff}
  </style>
</head>
<body class="bg-white text-slate-800">
  <nav class="screen-only border-b">
    <div class="container mx-auto px-5 py-3 flex items-center justify-between text-sm text-slate-600">
      <div class="smallcaps">Methodology White Paper</div>
      <div>Version 1.1</div>
    </div>
  </nav>

  <main class="container mx-auto px-5 py-10">
    <header class="mb-10">
      <h1 class="text-3xl md:text-4xl font-semibold text-slate-900">Energy‑Adjusted Metals Tailwind</h1>
      <div class="mt-2 text-slate-600 text-sm">Signal that extracts the copper‑specific demand residual after controlling for energy (WTI oil) and the broad U.S. dollar. Residual strength indicates a metals demand tailwind.</div>

      </div>
    </header>

    <section class="mb-10">
      <h2 class="text-2xl font-semibold text-slate-900 mb-3">Abstract</h2>
      <p class="leading-7">Copper prices embed both global demand impulses and cost/FX drivers. We regress copper on oil (energy input proxy) and the broad USD (pricing/FX headwind) to obtain a residual. A robust z‑score of that residual forms the <em>Metals Tailwind</em> index, mapped to <em>Demand_Tailwind</em>, <em>Neutral</em>, or <em>Headwind</em> regimes.</p>
    </section>

    <div class="rule mb-10"></div>

    <section class="mb-10">
      <h2 class="text-2xl font-semibold mb-3">1. Data</h2>
      <ul class="list-disc pl-6 leading-7">
        <li><strong>COPPER_YF_USD_LB</strong> — Copper price proxy from <code>yfinance</code> (<code>HG=F</code>, COMEX copper futures), daily (resample to month‑end).</li>
        <li><strong>DCOILWTICO</strong> — WTI spot price, daily (resample to month‑end).</li>
        <li><strong>DTWEXBGS</strong> — Trade Weighted U.S. Dollar Index: Broad, Goods, daily (resample to month‑end).</li>
      </ul>
      <p class="leading-7 mt-3">Construct <code>df_metals_adj</code> as a monthly panel with columns above before running the signal.</p>
      <p class="text-sm text-slate-600 mt-2">Units note: <code>HG=F</code> is typically quoted in USD per pound. Unit comparability vs USD/MT is not required for this signal because the residual is converted to a robust z‑score (scale‑invariant). If you need unit comparability for other use cases, USD/lb → USD/MT can be converted by multiplying by ~2204.6226.</p>
    </section>

    <section class="mb-10">
      <h2 class="text-2xl font-semibold mb-3">2. Model</h2>
      <p class="leading-7">Estimate a simple OLS of copper levels on oil and USD with an intercept, using all available overlapping observations (minimum 24 months). Compute the fitted value and residual:</p>
      <div class="box text-sm">
        <div class="eq">Copperₜ = β₀ + β₁·Oilₜ + β₂·USDₜ + εₜ</div>
        <div class="eq mt-1">Copper_Residualₜ = Copperₜ − Copper_Fittedₜ</div>
      </div>
      <p class="text-sm text-slate-600 mt-2">Levels regression is chosen for simplicity and interpretability; differenced or log specifications are valid alternatives when stationarity is a concern.</p>
    </section>

    <section class="mb-10">
      <h2 class="text-2xl font-semibold mb-3">3. Normalisation</h2>
      <div class="box text-sm">
        <div class="eq">zᵣₒᵦ(ε)ₜ = (εₜ − median(ε)ₜ,ᵥ) / (1.4826 × MAD(ε)ₜ,ᵥ)</div>
        <div class="text-xs mt-2">Rolling window <span class="eq">v = 60</span> months (minimum 24) to capture medium‑term deviations.</div>
      </div>
    </section>

    <section class="mb-10">
      <h2 class="text-2xl font-semibold mb-3">4. Regime Mapping</h2>
      <div class="box text-sm">
        <div class="eq">If Cₜ &gt; 0.75 → Demand_Tailwind · |Cₜ| ≤ 0.75 → Neutral · Cₜ &lt; −0.75 → Headwind</div>
      </div>
    </section>

    <section class="mb-10">
      <h2 class="text-2xl font-semibold mb-3">5. Implementation (Python)</h2>
      <div class="box text-sm">
<pre><code>import pandas as pd
import numpy as np

def robust_z(s, win=60, min_win=24):
    x = pd.to_numeric(s, errors="coerce").astype(float)
    w = max(min_win, min(win, x.dropna().size))
    med = x.rolling(w, min_periods=min_win).median()
    mad = (x - med).abs().rolling(w, min_periods=min_win).median()
    return (x - med) / (1.4826 * mad.replace(0, np.nan))

d = df_metals_adj.copy()

# Simple monthly OLS of copper on oil & USD (rolling residual level)
X = d[["DCOILWTICO","DTWEXBGS"]].copy()
X = X.assign(const=1.0)

y = d["COPPER_YF_USD_LB"]

mask = X.join(y).dropna().index
if len(mask) &gt;= 24:
    Xn = X.loc[mask, ["const","DCOILWTICO","DTWEXBGS"]].values
    yn = y.loc[mask].values
    beta = np.linalg.pinv(Xn.T @ Xn) @ (Xn.T @ yn)
    d.loc[mask, "Copper_Fitted"] = (Xn @ beta)
    d["Copper_Residual"] = d["COPPER_YF_USD_LB"] - d["Copper_Fitted"]
else:
    d["Copper_Residual"] = np.nan

d["Metals_Tailwind"] = robust_z(d["Copper_Residual"]) 

hi, lo = 0.75, -0.75

def _regime(v):
    if pd.isna(v): return np.nan
    return "Demand_Tailwind" if v &gt; hi else ("Headwind" if v &lt; lo else "Neutral")

d["Metals_Regime"] = d["Metals_Tailwind"].apply(_regime)

df_sig_metals = d
display(df_sig_metals.tail())
</code></pre>
      </div>
      <p class="text-sm text-slate-600 mt-3">If you previously used <code>PCOPPUSDM</code>, replace it with <code>COPPER_YF_USD_LB</code> throughout.</p>
    </section>

    <section class="mb-10">
      <h2 class="text-2xl font-semibold mb-3">6. Visualisation</h2>
      <p class="leading-7">Plot copper vs fitted copper on the primary axis, and the residual z‑score on a secondary axis. For long‑horizon context, the standard implementation plots the last <strong>30 years</strong> (where available).</p>
      <ul class="list-disc pl-6 leading-7 mt-3">
        <li>Primary axis: <strong>COPPER_YF_USD_LB</strong> vs <strong>Copper_Fitted</strong></li>
        <li>Secondary axis: <strong>Metals_Tailwind</strong> with thresholds at <code>±0.75</code></li>
        <li>Optional regime shading using <strong>Metals_Regime</strong></li>
      </ul>
    </section>

    <section class="mb-10">
      <h2 class="text-2xl font-semibold mb-3">7. Notes & Extensions</h2>
      <ul class="list-disc pl-6 leading-7">
        <li><strong>Specification:</strong> Consider logs and/or first differences to reduce heteroskedasticity; re‑estimate betas in a rolling window if time‑variation is expected.</li>
        <li><strong>Broader metals basket:</strong> Adapt the approach to aluminum, nickel, or a composite LME index.</li>
        <li><strong>FX controls:</strong> Replace broad USD with trade‑weighted EM FX for China/EM demand tilt.</li>
        <li><strong>Alternative copper proxies:</strong> Substitute a spot or LME series by replacing the copper column while keeping the OLS + robust z framework intact.</li>
      </ul>
    </section>

    <footer class="text-sm text-slate-500 border-t pt-6">© 2025. Methodology reference for the Energy‑Adjusted Metals Tailwind signal.</footer>
  </main>
</body>
</html>
